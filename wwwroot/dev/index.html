<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auth API Dev Console</title>
  <link rel="stylesheet" href="/dev/styles.css" />
</head>
<body>
  <main>
    <h1>Authentication API Dev Console</h1>
    <nav class="tabs">
      <button data-tab="auth" class="active">Auth</button>
      <button data-tab="email">Email</button>
      <button data-tab="mfa">MFA</button>
      <button data-tab="admin">Admin</button>
      <button data-tab="misc">Misc</button>
      <button data-tab="rules">Rules</button>
    </nav>

    <section id="auth" class="tab active">
      <h2>Register</h2>
      <div class="form-grid">
        <label for="regUser">Username <span class="hint" tabindex="0" data-hint="3–50 chars. Allowed: Unicode letters, numbers, dot (.), underscore (_), hyphen (-).">*</span></label>
        <input id="regUser" placeholder="e.g. alex.smith" />
        <label for="regEmail">Email <span class="hint" tabindex="0" data-hint="Lowercased, ≤254, valid address. Normalized on input.">*</span></label>
        <input id="regEmail" placeholder="e.g. user@example.com" />
        <label for="regFullName">Full Name <span class="hint" tabindex="0" data-hint="Optional. 2–100 chars. Letters/spaces/’-. , allowed. Leading/trailing punctuation stripped.">*</span></label>
        <input id="regFullName" placeholder="e.g. Alex J. Smith" />
        <label for="regPhone">Phone <span class="hint" tabindex="0" data-hint="Optional. E.164: + plus 8–15 digits (e.g., +15551234567).">*</span></label>
        <input id="regPhone" placeholder="e.g. +15551234567" />
        <label for="regPass">Password <span class="hint" tabindex="0" data-hint="Min 12 (16+ ideal). Must include at least one uppercase, one lowercase, one digit, and one symbol. Avoid using your username or email local part.">*</span></label>
        <input id="regPass" type="password" placeholder="min 12; upper/lower/digit/symbol" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{12,256}" title="Min 12; include uppercase, lowercase, digit, and symbol" />
        <ul id="regPassReqs" class="req-list">
          <li id="rpLen">At least 12 characters</li>
          <li id="rpUpper">At least one uppercase letter</li>
          <li id="rpLower">At least one lowercase letter</li>
          <li id="rpDigit">At least one digit</li>
          <li id="rpSymbol">At least one symbol</li>
        </ul>
        <div class="full">
          <button id="btnRegister">Register</button>
        </div>
      </div>
      <pre id="outRegister"></pre>
      <hr />
      <h2>Login</h2>
      <div class="form-grid">
        <label for="loginUser">Identifier <span class="hint" tabindex="0" data-hint="Email or username.">*</span></label>
        <input id="loginUser" placeholder="email or username" />
        <label for="loginPass">Password <span class="hint" tabindex="0" data-hint="1–256 chars.">*</span></label>
        <input id="loginPass" type="password" placeholder="password" />
        <label for="loginMfa">MFA Code <span class="hint" tabindex="0" data-hint="6 digits when prompted. You may use a recovery code instead.">*</span></label>
        <input id="loginMfa" placeholder="123456 or recovery" />
        <div class="full"><button id="btnLogin">Login</button></div>
      </div>
      <pre id="outLogin"></pre>
      <hr />
      <h2>Token Actions</h2>
      <button id="btnRefresh">Refresh</button>
      <button id="btnLogout">Logout (session)</button>
      <button id="btnLogoutAll">Logout All</button>
      <button id="btnMe">Me</button>
  <button id="btnCopyToken" title="Copy access token">Copy Access Token</button>
  <button id="btnDecodeToken" title="Decode access token">Decode Access Token</button>
      <pre id="outToken"></pre>
  <pre id="outTokenDecoded"></pre>
  <hr />
  <h2>Change Password</h2>
  <input id="cpCurrent" placeholder="current password" type="password" />
  <label for="cpNew">New Password <span class="hint" tabindex="0" data-hint="Min 12. Must include uppercase, lowercase, digit, and symbol.">*</span></label>
  <input id="cpNew" placeholder="new password" type="password" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{12,256}" title="Min 12; include uppercase, lowercase, digit, and symbol" />
  <ul id="cpReqs" class="req-list">
    <li id="cpLen">At least 12 characters</li>
    <li id="cpUpper">At least one uppercase letter</li>
    <li id="cpLower">At least one lowercase letter</li>
    <li id="cpDigit">At least one digit</li>
    <li id="cpSymbol">At least one symbol</li>
  </ul>
  <button id="btnChangePassword">Change Password</button>
  <pre id="outChangePassword"></pre>
    </section>

    <section id="email" class="tab">
      <h2>Email</h2>
      <div class="form-grid">
        <label for="emailAddr">Email <span class="hint" tabindex="0" data-hint="Lowercased; must match an account to take effect, but responses are generic.">*</span></label>
        <input id="emailAddr" placeholder="email" />
        <div class="full"><button id="btnReqConfirm">Request Email Confirm</button></div>
        <label for="emailToken">Confirm Token <span class="hint" tabindex="0" data-hint="Paste the token from the email. No spaces. Length ≤256.">*</span></label>
        <input id="emailToken" placeholder="confirm token" />
        <div class="full"><button id="btnConfirmEmail">Confirm Email</button></div>
        <label for="resetEmail">Reset Email <span class="hint" tabindex="0" data-hint="Address to send reset token to.">*</span></label>
        <input id="resetEmail" placeholder="reset email" />
        <div class="full"><button id="btnReqReset">Request Password Reset</button></div>
        <label for="resetToken">Reset Token <span class="hint" tabindex="0" data-hint="Paste the token from the email; no spaces.">*</span></label>
        <input id="resetToken" placeholder="reset token" />
        <label for="resetNew">New Password <span class="hint" tabindex="0" data-hint="Min 12. Must include uppercase, lowercase, digit, and symbol.">*</span></label>
        <input id="resetNew" type="password" placeholder="new password" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{12,256}" title="Min 12; include uppercase, lowercase, digit, and symbol" />
        <ul id="rsReqs" class="req-list">
          <li id="rsLen">At least 12 characters</li>
          <li id="rsUpper">At least one uppercase letter</li>
          <li id="rsLower">At least one lowercase letter</li>
          <li id="rsDigit">At least one digit</li>
          <li id="rsSymbol">At least one symbol</li>
        </ul>
        <div class="full"><button id="btnDoReset">Confirm Reset</button></div>
      </div>
      <pre id="outEmail"></pre>
    </section>

    <section id="change-email" class="tab">
      <h2>Change Email (requires login)</h2>
      <div class="form-grid">
        <label for="chgNewEmail">New Email <span class="hint" tabindex="0" data-hint="Same rules as email.">*</span></label>
        <input id="chgNewEmail" placeholder="new email" />
        <div class="full"><button id="btnChgEmailStart">Start</button></div>
        <label for="chgToken">Token <span class="hint" tabindex="0" data-hint="Token sent to the new email. No spaces.">*</span></label>
        <input id="chgToken" placeholder="token" />
        <div class="full"><button id="btnChgEmailConfirm">Confirm</button></div>
      </div>
      <pre id="outChangeEmail"></pre>
    </section>

    <section id="revoke" class="tab">
      <h2>Revoke Specific Refresh Token</h2>
      <input id="revokeToken" placeholder="refresh token" />
      <button id="btnRevoke">Revoke</button>
      <pre id="outRevoke"></pre>
    </section>

    <section id="mfa" class="tab">
      <h2>MFA</h2>
      <div class="row">
        <button id="btnMfaStart">Enroll Start</button>
        <button id="btnMfaQr">Get QR</button>
        <button id="btnMfaDisable">Disable</button>
        <button id="btnMfaRegen">Regen Recovery</button>
      </div>
      <div class="form-grid">
        <label for="mfaCode">Code/Recovery <span class="hint" tabindex="0" data-hint="Enter a current 6‑digit code or a recovery code to confirm enrollment.">*</span></label>
        <input id="mfaCode" placeholder="123456 or recovery" />
        <div class="full"><button id="btnMfaConfirm">Enroll Confirm</button></div>
      </div>
      <pre id="outMfa"></pre>
    </section>

    <section id="admin" class="tab">
      <h2>Admin</h2>
      <p>Requires Admin role.</p>
      <input id="adminUserId" placeholder="user id" />
      <button id="btnListSessions">List Sessions</button>
      <input id="adminSessId" placeholder="session id" />
      <button id="btnRevokeSession">Revoke Session</button>
      <button id="btnBumpVersion">Bump Token Version</button>
      <button id="btnLock">Lock</button>
      <button id="btnUnlock">Unlock</button>
  <hr />
  <h3>Key Management</h3>
  <button id="btnKeysList">List Keys</button>
  <button id="btnKeysRotate">Rotate</button>
  <hr />
  <h3>Create Client App</h3>
  <input id="clientName" placeholder="name" />
  <input id="clientScopes" placeholder="scopes (space-separated)" />
  <button id="btnCreateClient">Create</button>
  <hr />
  <h3>Send Test Email</h3>
  <input id="testTo" placeholder="to@example.com" />
  <input id="testSubject" placeholder="subject" />
  <input id="testBody" placeholder="body" />
  <button id="btnTestEmail">Send</button>
      <pre id="outAdmin"></pre>
    </section>

    <section id="misc" class="tab">
      <h2>JWKS & Health</h2>
      <button id="btnJwks">JWKS</button>
      <button id="btnHealthLive">Health Live</button>
      <button id="btnHealthReady">Health Ready</button>
      <pre id="outMisc"></pre>
  <hr />
  <h2>Client Credentials Token</h2>
  <input id="ccClientId" placeholder="client id (guid)" />
  <input id="ccSecret" placeholder="client secret" />
  <input id="ccScope" placeholder="scopes (space-separated)" />
  <button id="btnClientToken">Get Token</button>
      <pre id="outClientToken"></pre>
    </section>

    <section id="rules" class="tab">
      <h2>Input & Security Rules</h2>
      <h3>Normalization</h3>
      <ul>
        <li>All strings: trim + Unicode NFKC. Internal whitespace collapsed.</li>
        <li>Control characters rejected. Payload size ≤ 20 KB.</li>
        <li>Strict JSON: unexpected properties are rejected.</li>
      </ul>
      <h3>Registration</h3>
      <ul>
        <li>Email: lowercased, ≤254, must be valid format.</li>
        <li>Password: ≥12 chars; must include uppercase, lowercase, digit, and symbol; deny if contains username/email local part; deny known-breached (if enabled).</li>
        <li>Username: 3–50 [letters, numbers, . _ -].</li>
        <li>Full name: optional, 2–100.</li>
        <li>Phone: optional, E.164 +8–15 digits.</li>
        <li>Rate limit: 5/hour per IP. Response: “If that email exists, we’ve sent a confirmation link.”</li>
      </ul>
      <h3>Login</h3>
      <ul>
        <li>Identifier: email or username. Password ≤256 chars.</li>
        <li>Rate limit: 10 attempts / 15 min per IP+id. Generic errors only.</li>
        <li>MFA: require 6‑digit code when enabled; recovery codes accepted.</li>
      </ul>
      <h3>Email Confirmation</h3>
      <ul>
        <li>Token: base64url with length bounds; no spaces.</li>
        <li>On success: account confirmed. On failure: ask for a new token.</li>
        <li>Resend: cooldown + daily cap.</li>
      </ul>
      <h3>Refresh Tokens</h3>
      <ul>
        <li>Rotate on every use; reuse detection revokes family.</li>
        <li>Cookie/call size ≤ 1–2 KB; ASCII/base64url only.</li>
      </ul>
      <h3>MFA (TOTP)</h3>
      <ul>
        <li>Enroll: generate secret + verify one current 6‑digit code.</li>
        <li>Accept ±1 time step. Anti‑replay enforced.</li>
        <li>Recovery codes: 10 single‑use; view once; can regenerate.</li>
      </ul>
    </section>
  </main>
  <script src="/dev/main.js"></script>
</body>
</html>
